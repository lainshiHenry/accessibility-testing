"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const eventemitter3_1 = __importDefault(require("eventemitter3"));
class EventForwarder {
    constructor() {
        this.emitter = new eventemitter3_1.default();
        this.tasks = {};
        this.on = (action, fn) => {
            if (action === 'task') {
                Object.assign(this.tasks, fn);
            }
            else {
                this.emitter.on(action, fn);
            }
        };
    }
    forward(on) {
        if (Object.keys(this.tasks).length > 0) {
            on('task', this.tasks);
        }
        for (const event of this.emitter.eventNames()) {
            if (event === 'before:browser:launch') {
                on('before:browser:launch', (browser, launchOptions) => this.emitter
                    .listeners(event)
                    .reduce((prevLaunchOptions, listener) => listener(browser, prevLaunchOptions), launchOptions));
            }
            else {
                for (const listener of this.emitter.listeners(event)) {
                    on(event, listener);
                }
            }
        }
    }
}
exports.default = EventForwarder;
//# sourceMappingURL=EventForwarder.js.map